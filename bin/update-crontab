#!/bin/bash

export BASE="${BASE:-/srv/mirror.unej.ac.id/status}"

. "$BASE/lib/init.sh"
. "$BASE/lib/common.sh"

set -e

NODE=$1

if [ "$NODE" == "" ]; then
	NODE=$HOST
fi

NODEDIR=/srv/mirror/status/nodes/$NODE
CRON=/srv/mirror/status/data/cron/$NODE.cron

# Create crontab file

[ -f $CRON ] && cp $CRON $CRON.old
/srv/mirror/status/bin/make-crontab $NODE

# Update crontab

set +e
crontab -l > $CRON.old.active 2> /dev/null
set -e

sed '/BEGIN SEDOT CRONTAB LIST/,/END SEDOT CRONTAB LIST/d' $CRON.old.active > $CRON.active
cat $CRON >> $CRON.active
crontab - < $CRON.active

echo "Crontab updated."

